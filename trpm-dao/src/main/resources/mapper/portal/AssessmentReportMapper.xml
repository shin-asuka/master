<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AssessmentReportMapper">

	<sql id="assessmentReportColumns">assessment_report.id AS assessment_report_id,
		assessment_report.create_date_time AS
		assessment_report_create_date_time, assessment_report.name AS
		assessment_report_name,
		assessment_report.readed AS
		assessment_report_readed, assessment_report.url AS
		assessment_report_url, assessment_report.student_id AS
		assessment_report_student_id,assessment_report.score AS
		assessment_report_score,assessment_report.online_class_id AS
		assessment_report_online_class_id,
		assessment_report.update_date_time AS assessment_report_update_date_time,
		assessment_report.upload_date_time AS assessment_report_upload_date_time
	</sql>

	<sql id="assessmentReportWhere">
		<trim prefix="WHERE" prefixOverrides="AND">
			<if test="id!=0">AND assessment_report.id = #{id}</if>
			<if test="createDateTime!=null">AND assessment_report.create_date_time =
				#{createDateTime}
			</if>
			<if test="name!=null">AND assessment_report.name = #{name}</if>
			<if test="readed!=0">AND assessment_report.readed = #{readed}</if>
			<if test="url!=null">AND assessment_report.url = #{url}</if>
			<if test="studentId!=0">AND assessment_report.student_id = #{studentId}</if>
			<if test="score!=0">AND assessment_report.score = #{score}</if>
			<if test="onlineClassId!=0">AND assessment_report.online_class_id = #{onlineClassId}</if>
		</trim>
	</sql>

	<sql id="assessmentReportOrder">
		<if test="orderString!=null">ORDER BY ${orderString}</if>
	</sql>

	<sql id="assessmentReportLimit">LIMIT #{startLine},#{limitLine}</sql>

	<resultMap type="com.vipkid.trpm.entity.AssessmentReport" id="assessmentReportResultMap">
		<id column="assessment_report_id" property="id" />
		<result column="assessment_report_create_date_time" property="createDateTime" />
		<result column="assessment_report_name" property="name" />
		<result column="assessment_report_readed" property="readed" />
		<result column="assessment_report_url" property="url" />
		<result column="assessment_report_student_id" property="studentId" />
		<result column="assessment_report_score" property="score" />
		<result column="assessment_report_online_class_id" property="onlineClassId" />
		<result column="assessment_report_update_date_time" property="updateDateTime" />
		<result column="assessment_report_upload_date_time" property="uploadDateTime" />
	</resultMap>

	<select id="findDao" resultMap="assessmentReportResultMap" useCache="true">
		SELECT
		<include refid="assessmentReportColumns" />
		FROM assessment_report
		<include refid="assessmentReportWhere" />
		<include refid="assessmentReportOrder" />
	</select>

	<select id="countDao" resultType="int">
		SELECT COUNT(*) FROM assessment_report
		<include refid="assessmentReportWhere" />
	</select>

	<select id="pageDao" resultMap="assessmentReportResultMap" useCache="true">
		SELECT
		<include refid="assessmentReportColumns" />
		FROM assessment_report
		<include refid="assessmentReportWhere" />
		<include refid="assessmentReportOrder" />
		<include refid="assessmentReportLimit" />
	</select>

	<select id="limitDao" resultMap="assessmentReportResultMap" useCache="true">
		SELECT
		<include refid="assessmentReportColumns" />
		FROM assessment_report
		<include refid="assessmentReportWhere" />
		<include refid="assessmentReportOrder" />
		<include refid="assessmentReportLimit" />
	</select>

	<insert id="saveDao" useGeneratedKeys="true" keyProperty="id" flushCache="true">
		INSERT INTO assessment_report
		<trim prefix="(" prefixOverrides=",">
			<if test="id!=0">,id</if>
			<if test="createDateTime!=null">,create_date_time</if>
			<if test="name!=null">,name</if>
			<if test="readed!=0">,readed</if>
			<if test="url!=null">,url</if>
			<if test="studentId!=0">,student_id</if>
			<if test="score!=0">,score</if>
			<if test="onlineClassId!=0">,online_class_id</if>
			<if test="updateDateTime!=null">,update_date_time</if>
			<if test="uploadDateTime!=null">,upload_date_time</if>
		</trim>
		) VALUES
		<trim prefix="(" prefixOverrides=",">
			<if test="id!=0">,#{id}</if>
			<if test="createDateTime!=null">,#{createDateTime}</if>
			<if test="name!=null">,#{name}</if>
			<if test="readed!=0">,#{readed}</if>
			<if test="url!=null">,#{url}</if>
			<if test="studentId!=0">,#{studentId}</if>
			<if test="score!=0">,#{score}</if>
			<if test="onlineClassId!=0">,#{onlineClassId}</if>
			<if test="updateDateTime!=null">,#{updateDateTime}</if>
			<if test="uploadDateTime!=null">,#{uploadDateTime}</if>
		</trim>
		)
	</insert>

	<update id="updateDao" flushCache="true">
		UPDATE assessment_report
		<trim prefix="SET" prefixOverrides=",">
			<if test="id!=0">,id = #{id}</if>
			<if test="createDateTime!=null">,create_date_time = #{createDateTime}</if>
			<if test="name!=null">,name = #{name}</if>
			<if test="readed!=null">,readed = #{readed}</if>
			<if test="url!=null">,url = #{url}</if>
			<if test="studentId!=0">,student_id = #{studentId}</if>
			<if test="score!=0">,score = #{score}</if>
			<if test="onlineClassId!=0">,online_class_id = #{onlineClassId}</if>
			<if test="updateDateTime!=null">,update_date_time = #{updateDateTime}</if>
			<if test="uploadDateTime!=null">,upload_date_time = #{uploadDateTime}</if>
		</trim>
		<trim prefix="WHERE" prefixOverrides="AND">AND id = #{id}</trim>
	</update>

	<delete id="deleteDao" flushCache="true">
		DELETE FROM assessment_report
		<trim prefix="WHERE" prefixOverrides="AND">AND id = #{id}</trim>
	</delete>

    <!-- 通过StudentId, Name查询 -->
	<select id="findReportByStudentIdAndName" resultMap="assessmentReportResultMap" useCache="true">
		SELECT
		<include refid="assessmentReportColumns" />
		FROM assessment_report 
		WHERE 
		assessment_report.student_id = #{studentId} 
		AND assessment_report.name = #{name}
		ORDER BY assessment_report.create_date_time desc
		LIMIT 0,1
	</select>

</mapper>
