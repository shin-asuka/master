<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.vipkid.trpm.dao.BackgroundScreeningDao">
    <resultMap id="BackgroundScreeningResult" type="com.vipkid.trpm.entity.BackgroundScreening">
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="teacher_id" jdbcType="BIGINT" property="teacherId" />
        <result column="candidate_id" jdbcType="VARCHAR" property="candidateId" />
        <result column="screening_id" jdbcType="VARCHAR" property="screeningId" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="result" jdbcType="VARCHAR" property="result" />
        <result column="dispute_status" jdbcType="VARCHAR" property="disputeStatus" />
        <result column="dispute_created_at" jdbcType="DATE" property="disputeCreatedAt" />
        <result column="submitted_at" jdbcType="TIMESTAMP" property="submittedAt" />
        <result column="update_at" jdbcType="TIMESTAMP" property="updateAt" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
        <result column="web_link" jdbcType="LONGVARCHAR" property="webLink" />
        <result column="pdf_link" jdbcType="LONGVARCHAR" property="pdfLink" />
    </resultMap>


    <sql id="backgroundScreeningAllColumn">
        s.id,
        s.teacher_id,
        s.candidate_id,
        s.screening_id,
        s.status,
        s.result,
        s.dispute_status,
        s.dispute_created_at,
        s.submitted_at,
        s.update_at,
        s.create_time,
        s.update_time,
        s.web_link,
        s.pdf_link
    </sql>



    <insert id="insert"  useGeneratedKeys="true" keyProperty="id">
        INSERT INTO bg_sterling_screening (
            teacher_id,
            candidate_id,
            screening_id,
            STATUS,
            result,
            dispute_status,
            dispute_created_at,
            submitted_at,
            update_at,
            create_time,
            update_time,
            web_link,
            pdf_link
        )
        VALUES(
            #{teacherId,jdbcType=BIGINT},
            #{candidateId,jdbcType=VARCHAR},
            #{screeningId,jdbcType=VARCHAR},
            #{status,jdbcType=VARCHAR},
            #{result,jdbcType=VARCHAR},
            #{disputeStatus,jdbcType=VARCHAR},
            #{disputeCreatedAt,jdbcType=TIMESTAMP},
            #{submittedAt,jdbcType=TIMESTAMP},
            #{updateAt,jdbcType=TIMESTAMP},
            #{createTime,jdbcType=TIMESTAMP},
            #{updateTime,jdbcType=TIMESTAMP},
            #{webLink,jdbcType=LONGVARCHAR},
            #{pdfLink,jdbcType=LONGVARCHAR}
        )
    </insert>
    <insert id="dynamicInsert" useGeneratedKeys="true" keyProperty="id" >
        INSERT INTO bg_sterling_screening
        <trim prefix="(" prefixOverrides=",">
            <if test="teacherId!=0">,teacher_id</if>
            <if test="candidateId!=null">,candidate_id</if>
            <if test="screeningId!=null">,screening_id</if>
            <if test="status!=null">,status</if>
            <if test="result!=null">,result</if>
            <if test="disputeStatus!=null">,dispute_status</if>
            <if test="disputeCreatedAt!=null">,dispute_created_at</if>
            <if test="submittedAt!=null">,submitted_at</if>
            <if test="updateAt!=null">,update_at</if>
            <if test="createTime!=null">,create_time</if>
            <if test="updateTime!=null">,update_time</if>
            <if test="webLink!=null">,web_link</if>
            <if test="pdfLink!=null">,pdf_link</if>
        </trim>
        )
        VALUES
        <trim prefix="(" prefixOverrides=",">
            <if test="teacherId!=0">,#{teacherId,jdbcType=BIGINT}</if>
            <if test="candidateId!=null">,#{candidateId,jdbcType=VARCHAR}</if>
            <if test="screeningId!=null">,#{screeningId,jdbcType=VARCHAR}</if>
            <if test="status!=null">,#{status,jdbcType=VARCHAR}</if>
            <if test="result!=null">,#{result,jdbcType=VARCHAR}</if>
            <if test="disputeStatus!=null">,#{disputeStatus,jdbcType=VARCHAR}</if>
            <if test="disputeCreatedAt!=null">,#{disputeCreatedAt,jdbcType=TIMESTAMP}</if>
            <if test="submittedAt!=null">,#{submittedAt,jdbcType=TIMESTAMP}</if>
            <if test="updateAt!=null">,#{updateAt,jdbcType=TIMESTAMP}</if>
            <if test="createTime!=null">,#{createTime,jdbcType=TIMESTAMP}</if>
            <if test="updateTime!=null">,#{updateTime,jdbcType=TIMESTAMP}</if>
            <if test="webLink!=null">,#{webLink,jdbcType=LONGVARCHAR}</if>
            <if test="pdfLink!=null">,#{pdfLink,jdbcType=LONGVARCHAR}</if>
        </trim>
        )
    </insert>


    <update id="update" parameterType="com.vipkid.trpm.entity.BackgroundScreening" >
        update bg_sterling_screening
        <set>
            <if test="teacherId != null">
                teacher_id = #{teacherId,jdbcType=BIGINT},
            </if>
            <if test="candidateId != null">
                candidate_id = #{candidateId,jdbcType=VARCHAR},
            </if>
            <if test="screeningId != null">
                screening_id = #{screeningId,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=VARCHAR},
            </if>
            <if test="result != null">
                result = #{result,jdbcType=VARCHAR},
            </if>
            <if test="disputeStatus != null">
                dispute_status = #{disputeStatus,jdbcType=VARCHAR},
            </if>
            <if test="disputeCreatedAt != null">
                dispute_created_at = #{disputeCreatedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="submittedAt != null">
                submitted_at = #{submittedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updateAt != null">
                update_at = #{updateAt,jdbcType=TIMESTAMP},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="webLink != null">
                web_link = #{webLink,jdbcType=LONGVARCHAR},
            </if>
            <if test="pdfLink != null">
                pdf_link = #{pdfLink,jdbcType=LONGVARCHAR},
            </if>
        </set>

        where  id = #{id,jdbcType=BIGINT}

    </update>
    <select id="findByTeacherIdTopOne" resultMap="BackgroundScreeningResult" parameterType="Long">
        SELECT
          <include refid="backgroundScreeningAllColumn"/>
        FROM
        bg_sterling_screening s
        WHERE
        s.teacher_id =#{teacherId}
        ORDER BY s.id DESC LIMIT 1
    </select>
    <select id="findById" resultMap="BackgroundScreeningResult" parameterType="Long">
        SELECT
        <include refid="backgroundScreeningAllColumn"/>
        FROM
        bg_sterling_screening s
        WHERE
        s.id =#{id}
    </select>
    <select id="findIdByResultAndDisputeStatus" resultType="java.lang.Long" parameterType="java.lang.String">
        SELECT
          s.id
        FROM
        bg_sterling_screening s

        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="result != null">
              AND s.result = #{result}
            </if>
            <if test="disputeStatus != null">
              AND s.dispute_status = #{disputeStatus}
            </if>
        </trim>

    </select>
    <select id="findTeacherIdBycandidateIdNone" resultType="java.lang.Long" >
        SELECT
          s.teacher_id
        FROM
        bg_sterling_screening s
        WHERE
        s.candidate_id IS NULL
    </select>
    <select id="findByScreeningIdAndCandidateId" resultType="com.vipkid.trpm.entity.BackgroundScreening">
        SELECT
        <include refid="backgroundScreeningAllColumn"/>
        FROM
        bg_sterling_screening s
        <trim prefix="WHERE" prefixOverrides="AND">
            <if test="screeningId != null">
                AND s.screening_id = #{screeningId}
            </if>
            <if test="candidateId != null">
                AND s.candidate_id = #{candidateId}
            </if>
        </trim>

    </select>
</mapper>